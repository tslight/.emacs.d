# -*- mode: snippet -*-
# name: config
# key: conf
# --
$ConfigFile = "Config.psd1"
$Params     = @{
    BaseDirectory = $PSScriptRoot
    FileName      = $ConfigFile
}

if (Test-Path "$PSScriptRoot\\$ConfigFile") {
    try {
        $Config = Import-LocalizedData @Params
        $Config = Import-LocalizedData @Params
        foreach ($variable in $Config.keys) {
            Write-Verbose "Setting $var variable."
            New-Variable -Name "$variable" -Value $Config.$variable -Force
        }
    } catch {
        Write-Warning "Invalid configuration data in $ConfigFile."
        Write-Warning "Please fill out or correct $PSScriptRoot\\$ConfigFile."
        Write-Verbose $_.Exception.Message
        Write-Verbose $_.InvocationInfo.ScriptName
        Write-Verbose $_.InvocationInfo.PositionMessage
    }
} else {
    @"
@{
    ${1:Config Variable} = ""
}
"@ | Out-File -Encoding UTF8 -FilePath "$PSScriptRoot\\$ConfigFile"
    Write-Warning "Generated $PSScriptRoot\\$ConfigFile."
    Write-Warning "Please edit $ConfigFile and re-import module."
}
